package it.unipd.dei.eis;

import it.unipd.dei.eis.adapters.NyTimesCsvAdapter;
import it.unipd.dei.eis.adapters.TheGuardianJsonAdapter;
import it.unipd.dei.eis.serialization.Deserializer;
import it.unipd.dei.eis.serialization.Serializer;
import org.junit.Before;
import org.junit.Test;


import static org.junit.Assert.*;

/**
 * The {@code NyTimesCsvAdapterTest} class is a JUnit test class for the {@link NyTimesCsvAdapter} class.
 * It contains test methods to verify the functionality of the adapter.
 */
public class NyTimesCsvAdapterTest {

    private NyTimesCsvAdapter adapter;
    private Serializer serializer;
    @Before
    public void setUp() {
        serializer = new Serializer();
        adapter = new NyTimesCsvAdapter();
    }

    /**
     * Tests the {@link NyTimesCsvAdapter#loadArticles()} method to ensure articles are loaded successfully.
     * It also verifies the content of the articles by comparing their titles and body texts.
     */
    @Test
    public void testLoadArticles() {

        adapter.loadArticles();
        serializer.serialize(adapter.getArticles(), "articles.xml");

        // Verify that articles are loaded
        assertNotNull(adapter.getArticles());
        assertEquals(1000, adapter.getArticles().length);

        // Verify the content of the articles
        Article article1 = adapter.getArticles()[0];
        assertEquals("Hard Questions on Nuclear Power", article1.getTitle());
        assertEquals("After decades in the doghouse because of environmental, safety and cost concerns, nuclear power is enjoying a renaissance of expectations. The Bush administration's new energy plan gives a place of prominence to nuclear power as a clean and efficient energy source, and the industry itself is bubbling with new hopes and plans. In truth, there are good reasons to take a fresh look at this much-maligned source of energy that has been stalled in this country for the past three decades. But it is worrisome that the administration seems to have endorsed a nuclear resurgence with little sustained analysis of its pluses and minuses. As an article by Katharine Seelye in The Times revealed last week, nuclear energy was barely in the consciousness of the drill-centric energy team at the White House until a delegation of nuclear industry executives sought a chance to make their pitch and succeeded so well that Vice President Dick Cheney almost immediately started touting the virtues of nuclear energy. A case can be made for greater exploitation of nuclear power in this country, but before the nation plunges too far down this path the administration will need to address some critical questions. The rationale for a reassessment comes partly from the performance of the industry itself, and partly from changed circumstances in the environment in which it must operate. By most accounts, the industry has learned to operate its plants more safely and efficiently than in the years leading up to the traumatic near-tragedy at Three Mile Island. American nuclear plants are operating with much greater reliability and many fewer minor incidents. Moreover, the industry is consolidating, with plants being purchased and operated by companies that have more expertise than some of the previous operators. So there is reason to trust the industry a bit more than in past decades. Meanwhile, external events are increasing the appeal of nuclear power. One is the rising concern over global warming, which is caused primarily by the emission of carbon dioxide from burning fossil fuels. Nuclear power plants emit no carbon dioxide, thus to the extent they can replace plants burning coal, oil or natural gas they can be considered a plus. Nuclear power can also contribute to the diversity of the nation's energy supplies. Nuclear plants already supply some 20 percent of the electricity generated in this country, compared with fossil fuel contributions of 52 percent for coal, 16 percent for natural gas and 3 percent for oil. But the great majority of all new power plants are being built to burn natural gas, the cleanest of the fossil fuels, making utilities and consumers vulnerable to price spikes when supplies become tight as they have this year. President Bush's energy plan offers a wide range of steps to accelerate the use of nuclear power. But before Congress and the regulatory agencies proceed too far, some crucial questions require answers. Impact on global warming: If this is the main reason for turning to nuclear power, the proponents will need to do a much better job of spelling out just how far nuclear power would have to spread to make a real dent in the problem. Nuclear power is used almost exclusively to generate electricity, thus it cannot reduce the nation's reliance on imported oil to power transportation systems. Nuclear fuel will primarily be substituting for natural gas -- the least of the carbon dioxide emitters -- as the clean fuel to which electric utilities turn. Moreover, fossil fuels are burned in mining and preparing nuclear fuels and in building reactors, so even nuclear energy is not entirely free of greenhouse gases. Some analyses suggest that to make a real impact in slowing global warming, nuclear power plants would need to spread widely around the world, a prospect that brings new challenges of its own. Weapons risks: Expansion of nuclear power in this country poses no weapons danger, but the spread of nuclear plants into other countries could pose a risk. The uranium fuel for nuclear power plants is not generally considered of high enough grade to be used in weapons. But as more and more technicians around the world learn the skills of working with nuclear materials, and as governments become engaged in procuring nuclear technologies, there is a danger that civilian nuclear programs could serve as a cover for clandestine weapons activities. That is why, for example, the United States is angry that Russia is helping Iran build a nuclear power plant. Even though Iran has pledged to abide by nonproliferation treaties and allow international inspections of the plant, there is grave concern that it will find a way to build weapons. Increasing the use of nuclear power in countries that already have either the bomb or nuclear power plants is not much of a danger. Spreading nuclear power to additional countries might be. Waste disposal: In the political world, the lack of a proven method to store spent fuel from nuclear reactors for the tens of thousands of years the material remains radioactive has long been considered the Achilles' heel of the nuclear industry. In truth, spent fuel has been stored safely for decades in pools at the sites of nuclear power plants with no adverse effect. The problem is, the storage pools are filling up and critics are loath to expand nuclear power with no clear idea where to store the waste. The Bush administration is considering a site at Yucca Mountain in Nevada that has been studied for years, and it has proposed a new look at reprocessing the fuel to remove the long-lived plutonium for reuse as reactor fuel. That could greatly ease the storage problem here but might encourage wider use of reprocessed materials abroad, increasing the risk of weapons-grade plutonium's falling into the wrong hands. Reactor safety: The safety problem in conventional nuclear plants is that, if things start to go wrong, emergency cooling systems and human operators have to act correctly to prevent a catastrophic meltdown. That makes nuclear power a cruel and unforgiving technology that cannot tolerate equipment failures or human mistakes. But the industry is exploring new technologies that would not lead to meltdown even in a worst-case malfunction, making them inherently safer and cheaper to build and operate. This is where the administration and the industry should be focusing their efforts -- to develop demonstrably safer power plants. That would ease many of the concerns provoked by the current generation of nuclear reactors. Economics: No matter what else is done to make nuclear power more attractive, the industry will make little headway unless it can overcome the high capital costs that brought it to a halt in recent decades. Some relief should come from the advance approval of standardized designs, allowing plants to be built more quickly and cheaply than in past years when each plant had a customized design. But Congress will need to take a close look at whether it should renew one of the industry's economic underpinnings -- the so-called Price-Anderson Act that limits the liability of nuclear companies in the event of an accident. If the industry is as safe as it says, it may not need such subsidized protection. On the other hand, eliminating the liability protection might scare off investors for good. Nuclear power has been stalled for so long in the United States that it is surprising to see it back in the spotlight. There may be a case for extending the licenses of existing plants, as has already happened in several cases, or for building new plants on existing nuclear sites where the risks are already understood. But the case has not yet been made for truly large-scale expansion of nuclear power, in this country or around the globe.", article1.getBodyText());

        Article article2 = adapter.getArticles()[1];
        assertEquals("As Demand for Electricity Increases, China Sticks With Nuclear Power", article2.getTitle());
        assertEquals("BEIJING Meltdowns of three reactors at the Fukushima Daiichi nuclear power plant in Japan last March have put a chill on much of the world’s nuclear power industry — but not in China. The German Parliament voted this summer to close the country’s remaining nuclear power plants by 2022, while the Swiss Parliament voted this summer to phase nuclear power out by 2034. Economic stagnation in the United States and most other industrialized economies since 2008 has produced stagnant electricity demand, further sapping interest in nuclear power. In Japan itself, the government has put on hold its plans to build further nuclear power plants, and the government faces a political battle to continue operating existing reactors. Emerging economies like Brazil and particularly India are still planning nuclear reactors. But the Indian leaders introduced legislation on Sept. 7 that is supposed to increase the independence of nuclear regulators from the industry, though critics are skeptical. That leaves China poised to build more nuclear reactors in the coming years than the rest of the world combined. But questions abound whether China will be a savior for the international nuclear power industry, or a ferocious competitor that could create even greater challenges for nuclear power companies in the West. Chinese regulators performed a four-month review of safety at all existing nuclear reactors and reactors under construction after the Fukushima meltdowns and declared them safe. Safety reviews continue at reactors where construction had not yet started at the time of the Fukushima accident. Jiang Kejun, a director of the Energy Research Institute at the National Development and Reform Commission, the top Chinese economic planning agency, said that the government was sticking to its target of 50 gigawatts of nuclear power by 2015, compared to just 10.8 gigawatts at the end of last year. Mr. Jiang said in an interview that nuclear power construction targets for 2020 had not yet been set and might end up slightly lower than they would have been without the meltdowns in Fukushima. But he and other Chinese officials say that China’s rapidly rising electricity consumption makes nuclear power essential. They even try to portray the Fukushima incidents as salutary for the nuclear power industry, a view seldom heard elsewhere. “Globally, I think Fukushima could be a good thing for nuclear power,” Mr. Jiang said. “We can learn a lot from that. We can’t be smug or too clever.” China allowed existing reactors to continue operating during the safety review from March to July and allowed construction to continue at reactors where it had already begun. Chinese regulators have also encouraged electric utilities to continue planning future nuclear power plants. But one category of reactor has been delayed by the Fukushima incident. At reactors that had been approved before the Fukushima accident but where construction had not yet begun, the government still has not allowed construction to start while continuing to study whether further safety improvements can be made, said Xu Yuanhui, one of China’s top nuclear engineers for the past half century. The delay applies to several conventional nuclear reactors plus Beijing’s project to build two reactors in northeastern China, using a new generation of technology known as a pebble-bed design. Critics and advocates describe it as safer than current reactors, though its cost-effectiveness unclear. The two reactors in Shidao, in Shandong Province in northeast China, were approved days before the Fukushima nuclear accident began with an earthquake and tsunami March 11. But the 50-month timetable for building them cannot start until the government lifts its hold on construction. “By the end of this year, maybe we’ll have some information from the government side,” Dr. Xu said. Nuclear power represented only 1.1 percent of China’s electricity generation capacity at the end of last year. With wind turbines and coal-fired power plants being installed at rates that far surpass those in any other country, nuclear power is on track to account for no more than 4 percent of electricity capacity by 2015. A big part of the appeal of nuclear energy for Chinese officials is that it supplies baseload power, meaning it is available 24 hours a day and seven days a week to meet needs. China passed the United States last year as the world’s largest installer of wind turbines, but wind still accounts for only 3.2 percent of China’s installed electricity generation capacity and less than 2 percent of electricity generated. Coal remains by far the dominant source of electricity in China, producing three-quarters of the country’s electricity. Nuclear power mainly displaces coal as a source of baseload power. That has also made it popular with Chinese officials, as they have set increasingly ambitious targets to slow the country’s rapid rise in emissions of global warming gases, in which the country already leads the world. Until reliable, large-scale storage of electricity is perfected for renewable energy sources like the wind and sun, “they’ve got to continue using nuclear as a fundamental part of their fuel mix,” said James A. Maguire, the regional managing director for Asian infrastructure at Aon Risk Solutions, a risk management and insurance broker. Coal is the most polluting major source of electricity in terms of emissions of climate-changing gases, while nuclear power is one of the cleanest. Coal mining accidents also kill more than 2,000 people a year in China, and large areas of the countryside in northern China have been heavily polluted. China is paying particular attention to nuclear safety issues, however, because it has some of the world’s most densely populated rural areas. If a nuclear accident rendered even a small area around a power plant uninhabitable, many would need to be resettled. China now has an unusually varied fleet of nuclear reactors, using French, American, Russian and homegrown technology. While awarding contracts to a wide range of multinational nuclear power plant contractors, it has required that they provide documentation on exactly how to build the reactors. That will give China the ability to export reactors in a few years, in competition with industrialized nations, nuclear power industry experts warned. Demand outside China could revive if memories of the Fukushima accident fade or if worries about global warming become more pressing. China is not only acquiring technology. It is also creating economies of scale by building dozens of reactors at the same time. As a population equal to New York City’s moves into China’s cities each year demanding air-conditioners and other electricity-guzzling conveniences, consumption is likely to continue growing by double digits. “It’s the largest migration in history, so they need to build a lot of infrastructure,” said Dennis Bracy, the chief executive of the U.S.-China Clean Energy Forum, a bilateral discussion group formed by the Chinese government with prominent Americans from previous Republican and Democratic administrations. “I believe they will stay with nuclear as part of the portfolio.”", article2.getBodyText());
    }
    /**
     * Test the {@link NyTimesCsvAdapter#loadArticles()} method.
     * It loads articles from the CSV file and verifies that the articles are correctly loaded. (Check all articles)
     */
    @Test
    public void testAllLoadArticles() {
        adapter.loadArticles();
        // deserialize local xml
        Deserializer xml_dsl = new Deserializer();
        Article[] a = xml_dsl.deserialize("./articles.xml");

        System.out.println(adapter.getArticles()[0].getTitle());
        // check if title and bodyText matches
        int i = 0;
        for(Article article : adapter.getArticles()) {
            assertEquals(article.getTitle(),a[i].getTitle()); // ensure that the first article's title was parsed correctly
            assertEquals(article.getBodyText(), a[i].getBodyText()); // ensure that the first article's body text was parsed correctly
            i++;
        }
    }

    /**
     * Test the {@link NyTimesCsvAdapter#getArticles()} method.
     * It verifies that the array of articles is correctly returned.
     */
    @Test
    public void testGetArticles() {
        Article[] articles = adapter.getArticles();
        assertNotNull(articles); // ensure that the array of articles is not null
        assertEquals(0, articles.length); // ensure that the array of articles is empty if loadArticles has not been called yet

        adapter.loadArticles();
        articles = adapter.getArticles();
        assertNotNull(articles); // ensure that the array of articles is not null
        assertTrue(articles.length > 0); // ensure that the array of articles is not empty after loadArticles has been called
    }
}